<!DOCTYPE html>
<html lang="en">

<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Cornell Notes</title>

    <!-- codemirror -->
    <script src="node_modules/codemirror/lib/codemirror.js"></script>
    <link rel="stylesheet" href="node_modules/codemirror/lib/codemirror.css">
    <script src="node_modules/codemirror/mode/markdown/markdown.js"></script>
    <script src="node_modules/codemirror/addon/edit/continuelist.js"></script>
    <script src="node_modules/codemirror/addon/edit/closebrackets.js"></script>
    <script src="node_modules/codemirror/addon/mode/overlay.js"></script>
    <script src="node_modules/codemirror/addon/search/search.js"></script>
    <script src="cmMode.js"></script>
    <link rel="stylesheet" href="cm.css">


    <!-- styles -->
    <link rel="stylesheet" href="resources/fontawesome/fontawesome-free-6.5.1-web/css/all.css">
    <link rel="stylesheet" href="pagestyle.css">
    <link rel="stylesheet" href="node_modules/highlight.js/styles/atom-one-dark.css">
    <script src="https://cdn.jsdelivr.net/npm/uuid@8.3.2/dist/umd/uuid.min.js"></script>
    <script src="https://polyfill.io/v3/polyfill.min.js?features=es6"></script>

    <!-- render processes -->
    <script src="node_modules/marked/marked.min.js"></script>
    <script src="node_modules/highlight.js/lib/core.js"></script>
    <script src="https://cdnjs.cloudflare.com/ajax/libs/split.js/1.6.0/split.min.js"></script>
    <!-- math equations -->
    <script>
        window.MathJax = {
            tex: {
                inlineMath: [['$', '$']],
                displayMath: [['$$', '$$']]
            },
            startup: {
                ready: () => {
                    MathJax.startup.defaultReady();
                    MathJax.startup.promise.then(() => { });
                }
            }
        };
    </script>
    <script src="node_modules/mathjax/es5/tex-chtml.js"></script>
</head>

<body>
    <div id="searchDiv" style="display: none;">
        <input type="search" id="searchBox" placeholder="Enter search term"></input>
        <button id="findNextButton" title="Find next (Ctrl + G)"><i class="fa-solid fa-chevron-down"></i></button>
        <button id="findPreviousButton" title="Find previous (Ctrl + Shift + G)"><i
                class="fa-solid fa-chevron-up"></i></button>
        <button id="stopSearchButton" style="width: 20px;" title="Stop searching (Esc)"><i
                class="fas fa-times"></i></button>
    </div>

    <div id="toolbar">
        <div id="leftContainer" style="display: flex;">
            <button id="menuButton" style="width: 20px;" title="Menu">
                <i class="fa-solid fa-bars"></i>
            </button>
        </div>

        <div id="rightContainer">
            <button id="toggleReader" title="Reader mode">
                <i class="fa-solid fa-book-open"></i>
            </button>
            <button id="toggleEdit" title="Edit mode">
                <i class="fa-solid fa-pen-to-square"></i>
            </button>
            <button id="exportMarkdown" title="Export to Markdown">
                <i class="fa-brands fa-markdown"></i>
            </button>
            <div id="toggleColumn">
                <button id="toggleColumnButton" title="Toggle notes or cues">
                    <i class="fa-solid fa-grip-vertical"></i>
                </button>
                <div id="dropdown-content">
                    <label><input type="checkbox" id="cueCheckbox" value="true" checked>Cue</label>
                    <label><input type="checkbox" id="noteCheckbox" value="true" checked>Note</label>
                </div>
            </div>
            <button id="toggleOutline" title="Toggle outline">
                <i class="fa-solid fa-list"></i>
            </button>
        </div>
    </div>

    <div id="mainContainer" style="display: flex;">

        <div id="menu" style="display: block;">
            <div id="menuButtonDiv">
                <button id="return" title="Return to home page">
                    <i class="fa-solid fa-house"></i>
                </button>
                <button id="createNewFileButton" title="Create new file">
                    <i class="fa-solid fa-file-pen"></i>
                </button>
                <button id="createFolderButton" title="Create Folder">
                    <i class="fa-solid fa-folder-plus"></i>
                </button>
            </div>

            <div id="searchDocuments">
                <i class="fa-solid fa-magnifying-glass"></i>
                <div id="search-documents-input" contenteditable="true"></div>
            </div>

            <div id="directory-contents-list" data-path=""></div>

            <div id="search-documents-list"></div>
        </div>

        <div id="editorContainer">
            <input type="text" id="title">
            <div id="init" class="no-drag">
                <div class="buttons">
                    <button onclick="insertBlock(0)" id="startButton" title="Insert block on top"><i
                            class="fas fa-plus"></i></button>
                </div>
            </div>
            <div id="blocks">
                <!-- blocks go here -->
            </div>
        </div>

        <div id="outline" style="display: none;">
            <div id="outlineList">
                <!-- outline items here -->
            </div>
        </div>
    </div>

    <div id="bottomBar">
        <div id="log"></div>
    </div>

    <!-- data management -->
    <script src="saveData.js"></script>

    <!-- page management -->
    <script src="addRemoveBlocks.js"></script>
    <script src="pageFunctions.js"></script>
    <!-- <script> -->
    <!-- Split(['#menu', '#editorContainer', '#outline']) -->
    <!-- </script> -->

    <!-- electron transportation -->
    <script>
        // const { ipcRenderer } = require('electron');

        const title = document.getElementById('title');
        title.addEventListener("keypress", function (event) {
            // Check if the key pressed is 'Enter'
            if (event.key === 'Enter') {
                let newTitle = title.value;
                // Send the new title to the main process to rename the file
                ipcRenderer.send('rename-file', newTitle);
                title.blur();
            }
        });

        ipcRenderer.on('set-title', (event, fileName) => {
            document.getElementById('title').value = fileName;
        });

    </script>

    <script>
        var returnBtn = document.getElementById('return')
        returnBtn.addEventListener('click', function () {
            ipcRenderer.send('load-index')
        })
    </script>

    <script>
        function clearContents() {
            document.getElementById('blocks').innerHTML = '';
            document.getElementById('outlineList').innerHTML = '';

            // checkbox
            document.getElementById('cueCheckbox').checked = true;
            document.getElementById('noteCheckbox').checked = true;
        }

        function importJsonData(jsonData) {
            const blocksContainer = document.getElementById('blocks');
            clearContents();
            jsonData.forEach((blockData, index) => {
                insertBlock(index, blockData.cue, blockData.note, blockData.highlighted, blockData.id);
            });
        }

        ipcRenderer.on('json-file-data', (event, response) => {
            if (response.error) {
                console.error('Error loading JSON file:', response.message);
            } else {
                importJsonData(response.data);
            }
        });

        ipcRenderer.on('clear-contents', clearContents);
    </script>

    <script>
        document.addEventListener('click', function (event) {
            if (event.target.classList.contains('blockLink')) {
                event.preventDefault();
                ipcRenderer.send('open-new-window');
            }
            else if (event.target.tagName === 'A' && event.target.href.startsWith('http') && !event.target.classList.contains('blockLink')) {
                event.preventDefault();
                ipcRenderer.send('open-link-externally', event.target.href);
            }
        });
    </script>

    <!-- search function -->
    <script src="findInPage.js"></script>
    <script src="searchDocuments.js"></script>

    <!-- menu -->
    <script src="menu.js"></script>
    <script>
        ipcRenderer.on('get-current-dir', (event, path) => {
            document.getElementById('directory-contents-list').setAttribute('data-path', path);
        });
    </script>

    <!-- outline -->
    <script src="outline.js"></script>

    <!-- log -->
    <script>
        ipcRenderer.on('log-message', (event, message) => {
            const logElement = document.getElementById('log');
            logElement.innerHTML = '';
            logElement.innerHTML = message;

            // Set a timeout to clear the message after 10 seconds (10000 milliseconds)
            setTimeout(() => {
                logElement.innerHTML = ''; // Clear the message
            }, 5000); // 10000 milliseconds = 10 seconds
        });
    </script>
</body>

</html>