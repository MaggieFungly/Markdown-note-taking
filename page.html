<!DOCTYPE html>
<html lang="en">

<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Cornell Notes</title>
    <link rel="stylesheet" href="resources/fontawesome/fontawesome-free-6.5.1-web/css/all.css">
    <link rel="stylesheet" href="pagestyle.css">
    <link rel="stylesheet"
        href="https://cdnjs.cloudflare.com/ajax/libs/highlight.js/11.4.0/styles/atom-one-dark.min.css">
    <script src="https://cdn.jsdelivr.net/npm/uuid@8.3.2/dist/umd/uuid.min.js"></script>
    <script src="https://polyfill.io/v3/polyfill.min.js?features=es6"></script>
    <script src="https://cdn.jsdelivr.net/npm/marked/marked.min.js"></script>
    <script src="https://cdnjs.cloudflare.com/ajax/libs/highlight.js/11.9.0/highlight.min.js"></script>
    <script>
        window.MathJax = {
            tex: {
                inlineMath: [['$', '$']],
                displayMath: [['$$', '$$']]
            },
            startup: {
                ready: () => {
                    MathJax.startup.defaultReady();
                    MathJax.startup.promise.then(() => { });
                }
            }
        };
    </script>
    <script id="MathJax-script" async src="https://cdn.jsdelivr.net/npm/mathjax@3/es5/tex-mml-chtml.js"></script>
</head>

<body>
    <div id="toolbar">
        <button id="return">
            <i class="fas fa-chevron-left" title="Return to main page"></i>
        </button>
        <div id="rightContainer">
            <button id="printPage" title="Print this page"><i class="fas fa-print"></i></button>
            <button id="openInBrowser" title="Open in External browser"><i class="fas fa-globe"></i></button>
            <button id="toggleEdit" onclick="toggleEdit()" title="Edit all blocks"><i
                    class="fas fa-pencil-alt"></i></button>
            <button id="toggleDisplay" onclick="toggleDisplay()" title="Read all blocks"><i
                    class="far fa-file"></i></button>
            <button id="fontLarger" class="fontSizeButton" title="Larger Font"><i class="fa fa-font"
                    style="font-size: 16px;"></i></button>
            <button id="fontSmaller" class="fontSizeButton" title="Smaller Font"><i class="fa fa-font"
                    style="font-size: 12px;"></i></button>
        </div>
    </div>
    <br>
    <input type="text" id="title">
    <div id="init" class="no-drag">
        <div class="buttons">
            <button onclick="insertBlock(0)" id="startButton" title="Insert block on top"><i
                    class="fas fa-plus"></i></button>
        </div>
    </div>
    <div id="blocks">
        <!-- blocks go here -->
    </div>

    <!-- data management -->
    
    <script src="saveData.js"></script>

    <!-- page management -->
    <script src="addRemoveBlocks.js"></script>
    <script src="node_modules\.sortablejs-vAsaEdFD\Sortable.min.js"></script>
    <script src="pageFunctions.js"></script>

    <!-- electron transportation -->
    <script>
        const { ipcRenderer } = require('electron');

        ipcRenderer.on('set-title', (event, fileName) => {
            document.getElementById('title').value = fileName;
        });

        function importJsonData(jsonData) {
            const blocksContainer = document.getElementById('blocks');
            blocksContainer.innerHTML = '';
            jsonData.forEach((blockData, index) => {
                insertBlock(index, blockData.cue, blockData.note, blockData.highlighted, blockData.id);
            });
        }

        ipcRenderer.on('json-file-data', (event, response) => {
            if (response.error) {
                console.error('Error loading JSON file:', response.message);
            } else {
                importJsonData(response.data);
            }
        });

        document.addEventListener('click', function (event) {
            if (event.target.classList.contains('blockLink')) {
                event.preventDefault();
                ipcRenderer.send('open-new-window');
            }
            else if (event.target.tagName === 'A' && event.target.href.startsWith('http') && !event.target.classList.contains('blockLink')) {
                event.preventDefault();
                ipcRenderer.send('open-link-externally', event.target.href);
            }
        });
    </script>
</body>

</html>