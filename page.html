<!DOCTYPE html>
<html lang="en">

<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Cornell Notes</title>
    <!-- codemirror -->
    <script src="node_modules/codemirror/lib/codemirror.js"></script>
    <link rel="stylesheet" href="node_modules/codemirror/lib/codemirror.css">
    <link rel="stylesheet" href="cm.css">
    <script src="node_modules/codemirror/mode/markdown/markdown.js"></script>
    <script src="node_modules/codemirror/addon/edit/continuelist.js"></script>
    <script src="node_modules/codemirror/addon/edit/closebrackets.js"></script>

    <link rel="stylesheet" href="resources/fontawesome/fontawesome-free-6.5.1-web/css/all.css">
    <link rel="stylesheet" href="pagestyle.css">
    <link rel="stylesheet" href="node_modules/highlight.js/styles/atom-one-dark.css">
    <script src="https://cdn.jsdelivr.net/npm/uuid@8.3.2/dist/umd/uuid.min.js"></script>
    <script src="https://polyfill.io/v3/polyfill.min.js?features=es6"></script>
    <script src="node_modules/marked/marked.min.js"></script>
    <script src="node_modules/highlight.js/lib/core.js"></script>
    <script src="https://cdnjs.cloudflare.com/ajax/libs/split.js/1.6.0/split.min.js"></script>
    <!-- math equations -->
    <script>
        window.MathJax = {
            tex: {
                inlineMath: [['$', '$']],
                displayMath: [['$$', '$$']]
            },
            startup: {
                ready: () => {
                    MathJax.startup.defaultReady();
                    MathJax.startup.promise.then(() => { });
                }
            }
        };
    </script>
    <script src="node_modules/mathjax/es5/tex-chtml.js"></script>
</head>

<body>

    <div id="searchDiv" style="display: none;">
        <input type="text" id="searchBox" placeholder="Enter search term"></input>
        <button id="findNextButton"><i class="fa-solid fa-chevron-down"></i></button>
        <button id="findPreviousButton"><i class="fa-solid fa-chevron-up"></i></button>
        <button id="stopSearchButton" style="width: 20px;"><i class="fas fa-times"></i></button>
    </div>

    <div id="toolbar">
        <div id="leftContainer" style="display: flex;">
            <button id="menuButton" style="width: 20px;" title="Menu">
                <i class="fa-solid fa-bars"></i>
            </button>
            <button id="return">
                <i class="fas fa-chevron-left" title="Return to main page"></i>
            </button>
        </div>

        <div id="rightContainer">
            <button id="toggleReader" title="Reader mode"><i class="fa-solid fa-book-open"></i></button>
            <button id="toggleEdit" title="Edit mode"><i class="fa-solid fa-pen-to-square"></i></button>
            <button id="toggleOutline" title="Toggle outline"><i class="fa-solid fa-list"></i></button>
        </div>
    </div>

    <div id="mainContainer" style="display: flex;">
        <div id="menu" style="display: none;">
            <div id="directory-contents-list"></div>
        </div>

        <div id="editorContainer">
            <input type="text" id="title">
            <div id="init" class="no-drag">
                <div class="buttons">
                    <button onclick="insertBlock(0)" id="startButton" title="Insert block on top"><i
                            class="fas fa-plus"></i></button>
                </div>
            </div>
            <div id="blocks">
                <!-- blocks go here -->
            </div>
        </div>

        <div id="outline" style="display: none;"></div>

    </div>

    <!-- data management -->
    <script src="saveData.js"></script>

    <!-- page management -->
    <script src="addRemoveBlocks.js"></script>
    <script src="pageFunctions.js"></script>

    <!-- electron transportation -->
    <script>
        const { ipcRenderer } = require('electron');

        const title = document.getElementById('title');
        title.addEventListener("keypress", function (event) {
            // Check if the key pressed is 'Enter'
            if (event.key === 'Enter') {
                let newTitle = title.value;
                // Send the new title to the main process to rename the file
                ipcRenderer.send('rename-file', newTitle);
            }
        });
        ipcRenderer.on('rename-file', (event, status, newTitleWithoutExtension) => {
            if (status === 'success') {
                console.log('File renamed to', newTitleWithoutExtension);
            } else {
                console.error('Failed to rename file');
            }
        });

        ipcRenderer.on('set-title', (event, fileName) => {
            document.getElementById('title').value = fileName;
        });
    </script>

    <script>
        function importJsonData(jsonData) {
            const blocksContainer = document.getElementById('blocks');
            blocksContainer.innerHTML = '';
            jsonData.forEach((blockData, index) => {
                insertBlock(index, blockData.cue, blockData.note, blockData.highlighted, blockData.id);
            });
        }

        ipcRenderer.on('json-file-data', (event, response) => {
            if (response.error) {
                console.error('Error loading JSON file:', response.message);
            } else {
                importJsonData(response.data);
            }
        });
    </script>

    <script>
        document.addEventListener('click', function (event) {
            if (event.target.classList.contains('blockLink')) {
                event.preventDefault();
                ipcRenderer.send('open-new-window');
            }
            else if (event.target.tagName === 'A' && event.target.href.startsWith('http') && !event.target.classList.contains('blockLink')) {
                event.preventDefault();
                ipcRenderer.send('open-link-externally', event.target.href);
            }
        });
    </script>

    <!-- search function -->
    <script src="findInPage.js"></script>

    <!-- menu -->
    <script src="menu.js"></script>

    <!-- outline -->
    <script src="outline.js"></script>

</body>

</html>